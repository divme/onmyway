<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>爆炸icon</title>
    <style>
        *{margin:0;padding:0;}
        #canvas{
            display: block;
            border:1px dashed #424242;
            margin:10px auto;
            box-shadow:0 0 20px #000 inset,0 0 15px #101010 ;
        }
    </style>
</head>
<body>
<div class="container">
    <canvas id="canvas0" width="100" height="100"></canvas>
    <canvas id="canvas1" width="100" height="100"></canvas>
    <canvas id="canvas2" width="100" height="100"></canvas>
    <canvas id="canvas3" width="100" height="100"></canvas>
    <canvas id="canvas4" width="100" height="100"></canvas>
    <canvas id="canvas5" width="100" height="100"></canvas>
</div>


  <script>
      var canvas0 = document.getElementById('canvas0');
      var ctx0 = canvas.getContext('2d');

      var canvas1 = document.getElementById('canvas1');
      var ctx1 = canvas.getContext('2d');

      var canvas2 = document.getElementById('canvas2');
      var ctx2 = canvas.getContext('2d');

      var canvas3 = document.getElementById('canvas3');
      var ctx3 = canvas.getContext('2d');

      var canvas4 = document.getElementById('canvas4');
      var ctx4 = canvas.getContext('2d');

      var canvas5 = document.getElementById('canvas5');
      var ctx5 = canvas.getContext('2d');


      var areas  = [];  //存放爆炸小分队队员
      var counts = 10; //每行分为几份，总共counts*counts份
      var canvasX = 50, canvasY = 50;

      var img = new Image();
          img.src = 'img/icon.png';
      img.onload = function(){
          ctx.drawImage(img, canvasX, canvasY, img.width, img.height);
          canvas.addEventListener('click', boom)
      };


      function boom(e){
          var pointX = e.clientX - canvas.getBoundingClientRect().left;
          var pointY = e.clientY - canvas.getBoundingClientRect().top;

          ctx.rect(canvasX, canvasY, img.width, img.height);
          if(ctx.isPointInPath(pointX, pointY)){

//              图像摇晃
//                shake();
//              将图像分割，相关值以对象形式，存入一个数组
                divide(img);

//              将数组中的图像分割块渲染出来,并添加动作
                var Timer = setInterval(function(){
                    if(areas.length > 0){

                        updateArea();
                        renderArea(img);
                    }else{
                        clearInterval(Timer)
                    }
                },30)
          }
      }

//      图像摇晃
      function shake(){
          ctx.save();
          setInterval(function(){
              ctx.drawImage(img, canvasX, canvasY, img.width, img.height);
              ctx.translate(canvasX + img.width/2, canvasY + img.height/2);
              ctx.rotate(30);
          },30)
          ctx.restore()
      }
//图像进行爆炸小分队分组
      function divide(imgObj){
          for(var i = 0; i < counts; i++){
              for(var j = 0; j< counts; j++){
                  var area = {
//                          每个块在img上的起始位置
                      imgX: i*imgObj.width/counts,
                      imgY: j*imgObj.height/counts, //第一列，x为0，y递增
//                          每个块在canvas上的起始位置
                      x : canvasX + i*imgObj.width/counts,
                      y : canvasY + j*imgObj.height/counts, //第一列，x为50，y递增
//                      运动速度
//                      vx: Math.pow(-1,Math.floor(Math.random()*100))*(Math.random()*5+3),
//                      vy: Math.pow(-1,Math.floor(Math.random()*100))*(Math.random()*5+3),
                      vx: Math.pow(-1,Math.floor(Math.random()*100))*(Math.random()*3),
                      vy: Math.pow(-1,Math.floor(Math.random()*100))*(Math.random()*5+3),
                      g: 2,
//                      vy: Math.random()*5+5,
//                          每个块的宽高
                      width: imgObj.width/counts,
                      height:imgObj.height/counts
                  };
                  areas.push(area);
              }
          }
      }

//图像转换为爆炸小分队组图
      function renderArea(imgObj){
          ctx.clearRect(canvasX-30, canvasY-30, imgObj.width+80, imgObj.height+80);

          for(var m = 0, len = areas.length; m < len; m++){
               ctx.drawImage(imgObj, areas[m].imgX, areas[m].imgY, areas[m].width, areas[m].height, areas[m].x, areas[m].y, areas[m].width, areas[m].height);
          }
      }

//更新爆炸小分队成员的位置，实现运动
      function updateArea(){
          for(var m = 0; m < areas.length; m++){

                  areas[m].x += areas[m].vx;
                  areas[m].y += areas[m].vy;
                  areas[m].vy += areas[m].g;

              if (areas[m].x > img.width+80 || areas[m].x < 30 || areas[m].y > img.height+80 || areas[m].y <30){
                      areas.splice(m,1);
                      m = m-1
                  }

          }
      }
  </script>
</body>
</html>

