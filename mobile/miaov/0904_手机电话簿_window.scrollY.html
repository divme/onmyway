<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>windowScroll电话簿</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        *{margin:0; padding:0;}
        .page{
            position: relative;
        }
        .phonebook{
            position: relative;
            margin-right: 30px;
            transition: all .5s;
        }
        .letterleader{
            line-height: 40px;
            font-size: 16px;
            text-indent: 20px;
            background: #f4f4f4;
        }
        .phonebook ul li{
            line-height: 2.5;
            font-size: 14px;
            text-indent: 25px;
            border-top: 1px solid #f4f4f4;
        }
        .navbox{
            position: fixed;
            top: 0;
            right: 0;
            width: 30px;
            padding: 10px 0;
        }
        .navlist{
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }
        .nav{
            flex: 1 0 auto;

            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border-radius: 50%;
        }
        .curnav{
            background: #424242;
            color: #ffffff;
        }
    </style>
</head>
<body>
<div class="page">
    <div class="phonebook">
        <ul>
            <p class="letterleader" id="a" id="a">A</p>
            <li>阿猫</li>
            <li>阿狗</li>
            <p class="letterleader" id="b">B</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="d">D</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="e">E</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="f" id="f">F</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="h">H</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="i">I</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="k">K</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="l">L</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="m">M</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="n">N</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="p">P</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="r">R</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="s">S</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="t">T</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="w">W</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="y">Y</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <p class="letterleader" id="z">Z</p>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝塔</li>
            <li>贝克</li>
            <li>贝克</li>
            <li>贝克</li>
        </ul>
    </div>
    <div class="navbox">
        <div class="navlist">
            <div class="nav">A</div>
            <div class="nav">B</div>
            <div class="nav">C</div>
            <div class="nav">D</div>
            <div class="nav">E</div>
            <div class="nav">F</div>
            <div class="nav">G</div>
            <div class="nav">H</div>
            <div class="nav">I</div>
            <div class="nav">J</div>
            <div class="nav">K</div>
            <div class="nav">L</div>
            <div class="nav">M</div>
            <div class="nav">N</div>
            <div class="nav">O</div>
            <div class="nav">P</div>
            <div class="nav">Q</div>
            <div class="nav">R</div>
            <div class="nav">S</div>
            <div class="nav">T</div>
            <div class="nav">U</div>
            <div class="nav">V</div>
            <div class="nav">W</div>
            <div class="nav">X</div>
            <div class="nav">Y</div>
            <div class="nav">Z</div>
        </div>
    </div>
</div>
<script>
//    自执行函数计算导航条的自适应高度,并为导航栏添加tap事件
    !function init(){
        var height = window.innerHeight;
        var navlist = document.querySelector(".navlist");
        var nav = document.getElementsByClassName("nav");
        navlist.style.height = height - 20 + 'px';
        for (var i = 0, len = nav.length; i < len; i++){
            tap(nav[i], function(e){
                addClass(this, 'curnav');
                setPhonebook(this);
            })
        }
    }();
    window.addEventListener("scroll", scroll);
    function scroll(){
//         console.log("scroll")
        var scrollY, elPos, curDataid;
        var p = document.getElementsByClassName("letterleader");
        scrollY = window.scrollY;
        for(var i = 0, len = p.length; i < len; i++){
            elPos = getElPos(p[i]);
            if(Math.floor(elPos - scrollY) < 10){
                curDataid = p[i].id;
                setNavlist(curDataid);
            }
        }
    }
    function setNavlist(id){
        var nav = document.getElementsByClassName("nav");
        var txt;
        for(var i = 0, len = nav.length; i < len; i++){
            txt = nav[i].innerText.toLowerCase();
            if( txt == id){
                addClass(nav[i], "curnav");
            }
        }
    }

//    监听导航栏滑动，并据此切换内容
    (function(){
        var navlist = document.querySelector(".navlist");
        var nav = document.getElementsByClassName("nav");

        navlist.addEventListener('touchmove', function(e){
            window.removeEventListener("scroll", scroll);
            e.preventDefault(); // 阻止默认滑屏
            var pointY = e.touches[0].clientY;
            getCurnav(nav, pointY);
        });
        navlist.addEventListener("touchend", function(e){
            window.addEventListener("scroll", scroll);
        })
    }());

//    得到当前所在nav：
//        1. 给当前nav添加选中状态
//        2. 根据当前nav设置phonebook的位置
    function getCurnav(nav, posY){
        var curPos;
        for(var i = 0, len = nav.length; i < len; i++){
            curPos = nav[i].getBoundingClientRect();
            if(posY >= curPos.top && posY <= curPos.bottom){
                addClass(nav[i], 'curnav');
                setPhonebook(nav[i]);
            }
        }
    }

//    根据选中nav，设置phonebook的位置
    function setPhonebook(el){
        var curPos, curTop, scrollY;
        var phonebook = document.querySelector(".phonebook");
        var text = el.innerText.toLowerCase();
        var option = document.querySelector('p[id="'+text+'"]');
            if(option){
                curPos = option.getBoundingClientRect().top;
                curTop = window.scrollY;
                scrollY = curTop + curPos;
                window.scrollTo(0, scrollY);
            }else{
                var sibling = el.nextElementSibling;
                setPhonebook(sibling);
            }

    }

//    得到一个元素的属性值
    function getStyle(el, attr){
        if(window.getComputedStyle){
            return parseInt(window.getComputedStyle(el)[attr])
        }else{
            return parseInt(el.currentStyle[attr]);
        }
    }

    function getElPos(el){
        var pos = 0;
        while(el){
            pos += el.offsetTop;
            el = el.offsetParent;
        }
        return pos;
    }
//    添加class
    function addClass(ele, classname){
        var siblings = ele.parentNode.childNodes;
            siblings = [].slice.apply(siblings);
        var current, curIndex, curName;

        for(var i = 0, len = siblings.length; i < len; i++){
             current = siblings[i];
             if(current.nodeType == 1){
                 curIndex = current.className.indexOf(classname);
                 if( curIndex > -1){
                     curName = current.className.slice(0, curIndex);
                     current.className = curName;
                 }
             }

        }
        ele.className += ' ' +classname;
    }

//    tap 事件
    function tap(el, callback){
        var startX, startY;
        var endX, endY;
        el.addEventListener('touchstart',function(e){
            window.removeEventListener("scroll", scroll);
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });
        el.addEventListener('touchend',function(e){
            endX = e.changedTouches[0].clientX;
            endY = e.changedTouches[0].clientY;
            if(Math.abs(endX-startX) < 5 && Math.abs(endY-startY) < 5){
                callback && callback.call(el, e);
            }
            window.addEventListener("scroll", scroll);
        })
    }
</script>
</body>
</html>